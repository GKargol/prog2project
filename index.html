<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Modern Form</title>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <div class="container">
      <h1>Submit Your Answers</h1>
      <form action="/submit" method="post" onsubmit="return validateForm();">
        <!-- Question 1 -->
        <div class="question-container">
          <label for="question1">Question 1:</label>
          <input
            type="text"
            id="question1"
            name="question1"
            placeholder="Your answer"
            required
          />
          <span class="error-message" id="question1Error"></span>
        </div>

        <!-- Question 2 -->
        <div class="question-container">
          <label for="question2">Question 2:</label>
          <input
            type="text"
            id="question2"
            name="question2"
            placeholder="Your answer"
            required
          />
          <span class="error-message" id="question2Error"></span>
        </div>

        <!-- Question 3 -->
        <div class="question-container">
          <label for="question3">Question 3:</label>
          <input
            type="text"
            id="question3"
            name="question3"
            placeholder="Your answer"
            required
          />
          <span class="error-message" id="question3Error"></span>
        </div>

        <!-- Question 4 -->
        <div class="question-container">
          <label for="question4">Question 4:</label>
          <input
            type="text"
            id="question4"
            name="question4"
            placeholder="Your answer"
            required
          />
          <span class="error-message" id="question4Error"></span>
        </div>

        <!-- Question 5 -->
        <div class="question-container">
          <label for="question5">Question 5:</label>
          <input
            type="text"
            id="question5"
            name="question5"
            placeholder="Your answer"
            required
          />
          <span class="error-message" id="question5Error"></span>
        </div>

        <!-- Question 6 -->
        <div class="question-container">
          <label for="question6">Question 6:</label>
          <input
            type="text"
            id="question6"
            name="question6"
            placeholder="Your answer"
            required
          />
          <span class="error-message" id="question6Error"></span>
        </div>

        <button type="submit">Submit</button>
      </form>
    </div>

    <script>
      function validateForm() {
        let hasError = false;

        const form = document.querySelector("form");
        const inputElements = form.querySelectorAll("input[type='text']");

        inputElements.forEach((input) => {
          const questionValue = input.value.trim();
          const errorElement = document.getElementById(`${input.id}Error`);
          if (questionValue === "") {
            errorElement.textContent = "Please fill out this field";
            hasError = true;
          } else if (questionValue.includes(" ")) {
            errorElement.textContent = "Spaces are not allowed";
            hasError = true;
          } else {
            errorElement.textContent = "";
          }
        });

        if (!hasError) {
          submitForm(); // Call the submitForm function if there are no errors
        }

        return false; // Prevent the form from actually submitting
      }

      async function submitForm() {
        const form = document.querySelector("form");
        const inputElements = form.querySelectorAll("input[type='text']");
        const questions = [];

        inputElements.forEach((input) => {
          const questionId = input.id;
          const questionValue = input.value.trim();
          questions.push({ id: questionId, value: questionValue });
        });

        const formData = JSON.stringify({ questions });

        try {
          const response = await fetch("/submit", {
            method: "POST",
            body: formData,
            headers: {
              "Content-Type": "application/json", // Set the content type to JSON
            },
          });

          if (response.ok) {
            form.reset();
            window.location.href = "/submit.html"; // Redirect to /submit.html upon success
          } else {
            alert("Failed to submit data to MongoDB");
          }
        } catch (error) {
          console.error(error);
          alert("An error occurred while submitting the form.");
        }
      }
    </script>
  </body>
</html>
