<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Performance Report</title>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <!-- Add a container for the dashboard button -->
    <div class="button-container">
      <a href="/dashboard">Dashboard</a>
      <a href="/statsheet.html">Stat Sheet Form</a>
      <button id="theme-toggle">Toggle Dark Mode</button>
    </div>

    <div id="tooltip-container"></div>
    <div class="container">
      <h1>Performance Report House53</h1>
      <div id="section1" class="form-section">
        <h2>Section 1: Background</h2>
        <form>
          <!-- Question 1 -->
          <div class="question-container">
            <label for="question1"
              >Name:
              <span class="info-icon" title="Enter your full name"
                >&#9432;
                <div class="tooltip">Enter your full name</div>
              </span></label
            >
            <div class="input-info-container">
              <input
                type="text"
                id="question1"
                name="question1"
                placeholder="Your answer"
                pattern="[A-Za-z\s.,'-]+"
                title="Only letters, spaces, and .,',- are allowed"
                required
              />
            </div>
            <span class="error-message" id="question1Error"></span>
          </div>

          <!-- Question 2 -->
          <div class="question-container">
            <label for="question2"
              >Address:
              <span class="info-icon" title="Enter your current address"
                >&#9432;
                <div class="tooltip">Enter your current address</div>
              </span></label
            >
            <div class="input-info-container">
              <input
                type="text"
                id="question2"
                name="question2"
                placeholder="Your answer"
                pattern="[0-9A-Za-z\s.,'-]+"
                title="Include numbers, letters, spaces, and .,',-"
                required
              />
            </div>
            <span class="error-message" id="question2Error"></span>
          </div>

          <!-- Question 3 -->
          <div class="question-container">
            <label for="question3"
              >Age:
              <span class="info-icon" title="Enter your age"
                >&#9432;
                <div class="tooltip">Enter your age</div>
              </span>
            </label>
            <div class="input-info-container">
              <input
                type="text"
                id="question3"
                name="question3"
                placeholder="Your answer"
                pattern="\d+"
                title="Only numeric values are allowed"
                required
              />
            </div>
            <span class="error-message" id="question3Error"></span>
          </div>

          <!-- Question 4 -->
          <div class="question-container">
            <label for="question4"
              >DOB:
              <span class="info-icon" title="Enter your date of birth"
                >&#9432;
                <div class="tooltip">Enter your date of birth</div>
              </span></label
            >
            <div class="input-info-container">
              <input
                type="date"
                id="question4"
                name="question4"
                placeholder="Your answer"
                required
              />
            </div>
            <span class="error-message" id="question4Error"></span>
          </div>

          <!-- Question 5 -->
          <div class="question-container">
            <label for="question5"
              >Sex:
              <span class="info-icon" title="Enter your preferred gender"
                >&#9432;
                <div class="tooltip">Enter your preferred gender</div>
              </span></label
            >
            <div class="input-info-container">
              <input
                type="text"
                id="question5"
                name="question5"
                placeholder="Your answer"
                pattern="[A-Za-z\s.,'-]+"
                title="Only letters, spaces, and .,',- are allowed"
                required
              />
            </div>
            <span class="error-message" id="question5Error"></span>
          </div>

          <!-- Question 6 -->
          <div class="question-container">
            <label for="question6"
              >Email:
              <span class="info-icon" title="Enter your email"
                >&#9432;
                <div class="tooltip">Enter your email</div>
              </span></label
            >
            <input
              type="email"
              id="question6"
              name="question6"
              placeholder="Your answer"
              required
            />
            <span class="error-message" id="question6Error"></span>
          </div>

          <!-- Question 7 -->
          <div class="question-container">
            <label for="question7"
              >Current Level:
              <span class="info-icon" title="Enter your current golf level"
                >&#9432;
                <div class="tooltip">Enter your current golf level</div>
              </span></label
            >
            <input
              type="text"
              id="question7"
              name="question7"
              placeholder="Your answer"
              pattern="[A-Za-z\s.,'-]+"
              title="Only letters, spaces, and .,',- are allowed"
              required
            />

            <span class="error-message" id="question7Error"></span>
          </div>

          <!-- Question 8 -->
          <div class="question-container">
            <label for="question8"
              >Hdep:
              <span class="info-icon" title="Enter your current handicap"
                >&#9432;
                <div class="tooltip">Enter your current handicap</div>
              </span></label
            >
            <input
              type="text"
              id="question8"
              name="question8"
              placeholder="Your answer"
              pattern="[0-9+()-\s]+"
              title="Only numbers, plus signs, hyphens, parentheses, and spaces are allowed"
              required
            />
            <span class="error-message" id="question8Error"></span>
          </div>

          <!-- Question 8 -->
          <div class="question-container">
            <label for="question9"
              >Goal Hdep:
              <span class="info-icon" title="Enter your goal handicap"
                >&#9432;
                <div class="tooltip">Enter your goal handicap</div>
              </span></label
            >
            <input
              type="text"
              id="question9"
              name="question9"
              placeholder="Your answer"
              pattern="[0-9+()-\s]+"
              title="Only numbers, plus signs, hyphens, parentheses, and spaces are allowed"
              required
            />
            <span class="error-message" id="question9Error"></span>
          </div>

          <!-- Question 10 -->
          <div class="question-container">
            <label for="question10"
              >Best Finish Last Season:
              <span
                class="info-icon"
                title="Enter your best finish from last season played"
                >&#9432;
                <div class="tooltip">
                  Enter your best finish from last season played
                </div>
              </span></label
            >
            <input
              type="text"
              id="question10"
              name="question10"
              placeholder="Your answer"
              pattern="[A-Za-z\s.,'-]+"
              title="Only letters, spaces, and .,',- are allowed"
              required
            />
            <span class="error-message" id="question9Error"></span>
          </div>

          <!-- Question 11 -->
          <div class="question-container">
            <label for="question11"
              >Low Score Last Season:
              <span
                class="info-icon"
                title="Enter your lowest score last season played"
                >&#9432;
                <div class="tooltip">
                  Enter your lowest score last season played
                </div>
              </span></label
            >
            <input
              type="text"
              id="question11"
              name="question11"
              placeholder="Your answer"
              pattern="\d+"
              title="Only numeric values are allowed"
              required
            />
            <span class="error-message" id="question11Error"></span>
          </div>

          <!-- Question 12 -->
          <div class="question-container">
            <label for="question12"
              >Year Long Goals:
              <span class="info-icon" title="Enter your year long goals"
                >&#9432;
                <div class="tooltip">Enter your year long goals</div>
              </span></label
            >
            <input
              type="text"
              id="question12"
              name="question12"
              placeholder="Your answer"
              pattern="[A-Za-z\s.,'-]+"
              title="Only letters, spaces, and .,',- are allowed"
              required
            />
            <span class="error-message" id="question12Error"></span>
          </div>

          <!-- Question 13 -->
          <div class="question-container">
            <label for="question13"
              >First 3 Month Benchmarks - Golf Instructor:</label
            >
            <input
              type="text"
              id="question13"
              name="question13"
              placeholder="Your answer"
              pattern="[A-Za-z\s.,'-]+"
              title="Only letters, spaces, and .,',- are allowed"
              required
            />
            <span class="error-message" id="question13Error"></span>
          </div>

          <!-- Question 14 -->
          <div class="question-container">
            <label for="question14">First 3 Month Benchmarks - Fitness:</label>
            <input
              type="text"
              id="question14"
              name="question14"
              placeholder="Your answer"
              pattern="[A-Za-z\s.,'-]+"
              title="Only letters, spaces, and .,',- are allowed"
              required
            />
            <span class="error-message" id="question14Error"></span>
          </div>

          <button type="button" onclick="showSection('section2')">Next</button>
        </form>
      </div>

      <div id="section2" class="form-section" style="display: none">
        <h2>Section 2: Golf Scores</h2>
        <form>
          <!-- Question 15 -->
          <div class="question-container">
            <label for="question15"
              >Post Season Score:
              <span class="info-icon" title="Enter your post season score"
                >&#9432;
                <div class="tooltip">Enter your post season score</div>
              </span></label
            >
            <input
              type="text"
              id="question15"
              name="question15"
              placeholder="Your answer"
              pattern="\d+"
              title="Only numeric values are allowed"
              required
            />
            <span class="error-message" id="question15Error"></span>
          </div>

          <!-- Question 16 -->
          <div class="question-container">
            <label for="question16"
              >Off Season Score:
              <span class="info-icon" title="Enter your off season score"
                >&#9432;
                <div class="tooltip">Enter your off season score</div>
              </span></label
            >
            <input
              type="text"
              id="question16"
              name="question16"
              placeholder="Your answer"
              pattern="\d+"
              title="Only numeric values are allowed"
              required
            />
            <span class="error-message" id="question16Error"></span>
          </div>

          <!-- Question 17 -->
          <div class="question-container">
            <label for="question17"
              >Pre Season Score:
              <span class="info-icon" title="Enter your pre season score"
                >&#9432;
                <div class="tooltip">Enter your pre season score</div>
              </span></label
            >
            <input
              type="text"
              id="question17"
              name="question17"
              placeholder="Your answer"
              pattern="\d+"
              title="Only numeric values are allowed"
              required
            />
            <span class="error-message" id="question17Error"></span>
          </div>

          <!-- Question 18 -->
          <div class="question-container">
            <label for="question18"
              >Regular Season (July-September) Score:
              <span class="info-icon" title="Only for July-September"
                >&#9432;
                <div class="tooltip">Only for July-September</div>
              </span></label
            >
            <input
              type="text"
              id="question18"
              name="question18"
              placeholder="Your answer"
              pattern="\d+"
              title="Only numeric values are allowed"
              required
            />
            <span class="error-message" id="question18Error"></span>
          </div>

          <!-- Question 19 -->
          <div class="question-container">
            <label for="question19"
              >Regular Season (October-December) Score:
              <span class="info-icon" title="Only for October-December"
                >&#9432;
                <div class="tooltip">Only for October-December</div>
              </span></label
            >
            <input
              type="text"
              id="question19"
              name="question19"
              placeholder="Your answer"
              pattern="\d+"
              title="Only numeric values are allowed"
              required
            />
            <span class="error-message" id="question19Error"></span>
          </div>

          <button type="button" onclick="showSection('section1')">
            Previous
          </button>
          <button type="button" onclick="showSection('section3')">Next</button>
        </form>
      </div>

      <div id="section3" class="form-section" style="display: none">
        <h2>Section 3: Final Questions</h2>
        <form>
          <div class="question-container">
            <label for="question1"
              >Anything Else?
              <span
                class="info-icon"
                title="Feel free to leave any notes for the instructor"
                >&#9432;
                <div class="tooltip">
                  Feel free to leave any notes for the instructor
                </div>
              </span></label
            >
            <div class="input-info-container">
              <input
                type="text"
                id="question20"
                name="question20"
                placeholder="Anything Else You'd Like to Note"
                pattern="[A-Za-z\s.,'-]+"
                title="Only letters, spaces, and .,',- are allowed"
              />
            </div>
            <span class="error-message" id="question20Error"></span>
          </div>

          <button type="button" onclick="showSection('section2')">
            Previous
          </button>
          <button type="button" onclick="submitForm()">Submit</button>
        </form>
      </div>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const inputs = document.querySelectorAll("input");
        inputs.forEach((input) => {
          input.addEventListener("blur", () => {
            input.classList.add("touched");
            validateInput(input);
          });

          input.addEventListener("input", () => {
            validateInput(input);
          });
        });

        function validateInput(input) {
          const errorElement = document.getElementById(input.id + "Error");
          if (!input.checkValidity() && input.classList.contains("touched")) {
            errorElement.textContent = input.title || "Invalid input";
          } else {
            errorElement.textContent = "";
          }
        }

        const themeToggle = document.getElementById("theme-toggle");
        const isDarkMode = localStorage.getItem("darkMode") === "true";
        if (isDarkMode) {
          document.body.classList.add("dark-mode");
        }

        themeToggle.addEventListener("click", () => {
          document.body.classList.toggle("dark-mode");
          localStorage.setItem(
            "darkMode",
            document.body.classList.contains("dark-mode")
          );
        });
      });

      function showSection(sectionId) {
        const sections = document.querySelectorAll(".form-section");
        sections.forEach((section) => {
          section.style.display = section.id === sectionId ? "block" : "none";
        });
      }

      async function submitForm() {
        let hasError = false;
        const inputs = document.querySelectorAll("input[required]");
        const errorMessages = document.querySelectorAll(".error-message");

        // Clear all previous error messages first
        errorMessages.forEach((errorMessage) => {
          errorMessage.textContent = "";
        });

        inputs.forEach((input) => {
          // Constructing the error element ID based on the input's ID
          const errorElementId = input.id + "Error";
          const errorElement = document.getElementById(errorElementId);

          if (errorElement) {
            // Check if the error element actually exists
            if (!input.value.trim()) {
              errorElement.textContent = "Please fill out this field";
              hasError = true;
            } else {
              errorElement.textContent = ""; // Clear any existing error message if the field is now valid
            }
          } else {
            // Log an error if the error element does not exist (this helps in debugging)
            console.error("Error element not found for:", errorElementId);
          }
        });

        if (hasError) {
          alert("Please fill out all required fields.");
          return; // Stop further execution if there are errors
        }

        const formData = Array.from(inputs).map((input) => ({
          id: input.id,
          value: input.value.trim(),
        }));

        try {
          const response = await fetch("/submit", {
            method: "POST",
            body: JSON.stringify({ questions: formData }),
            headers: { "Content-Type": "application/json" },
          });

          if (response.ok) {
            document
              .querySelectorAll(".form-section form")
              .forEach((form) => form.reset());
            window.location.href = "/submit.html";
          } else {
            alert("Failed to submit data.");
          }
        } catch (error) {
          console.error(error);
          alert("An error occurred while submitting the form.");
        }
      }
    </script>
  </body>
</html>
